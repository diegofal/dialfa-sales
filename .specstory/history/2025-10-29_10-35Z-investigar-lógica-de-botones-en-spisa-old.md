<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session a04b2160-6159-4614-891b-ee7d0fc996d8 (2025-10-29 10:35Z) -->

# Investigar l√≥gica de botones en spisa_old (2025-10-29 10:35Z)

_**User (2025-10-29 02:23Z)**_

necesito que investigues en spisa_old la logica que deberian tener esos botones en base al estado de nota pedidos facturas etc. lo que haga falta. 

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
El usuario me est√° pidiendo que investigue la l√≥gica de los botones en el sistema antiguo (spisa_old) para entender c√≥mo deber√≠an comportarse bas√°ndose en el estado de notas de pedido, facturas, etc.

Mirando la imagen, veo botones como:
- "Volver"
- "Cancelar Pedido"
- "Eliminar"
- "Crear Factura"
- "Guardar Cambios"

Necesito buscar en el c√≥digo del proyecto antiguo (d:\dialfa new\spisa\) para entender la l√≥gica de negocio detr√°s de estos botones en el contexto de pedidos/√≥rdenes de venta.

Voy a buscar:
1. Formularios o vistas relacionadas con pedidos/√≥rdenes de venta
2. La l√≥gica de estado de pedidos
3. Las condiciones para habilitar/deshabilitar botones
4. La l√≥gica de creaci√≥n de facturas desde pedidos
5. La l√≥gica de cancelaci√≥n y eliminaci√≥n

Empezar√© buscando en el proyecto de presentaci√≥n (SPISA.Presentacion) ya que ah√≠ deber√≠a estar la UI y la l√≥gica de botones.</details></think>

---

Voy a investigar la l√≥gica de los botones en el sistema antiguo para entender c√≥mo deber√≠an comportarse seg√∫n el estado de los pedidos, facturas, etc.

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">

</tool-use>

---

D√©jame buscar de otra manera, explorando los archivos del proyecto antiguo:

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "class.*Pedido|class.*Order" in "d:\dialfa new\spisa\SPISA.Presentacion" ‚Ä¢ 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `SPISA.Presentacion\UC\ListadoPedidos.cs` | `public partial class ListadoPedidos : BaseControl` | L16 |
| `SPISA.Presentacion\UC\ListadoPedidos.Designer.cs` | `partial class ListadoPedidos` | L3 |
| `SPISA.Presentacion\UC\NotaPedido.cs` | `public partial class UcNotaPedido : BaseControl` | L16 |
| `SPISA.Presentacion\UC\NotaPedido.Designer.cs` | `partial class UcNotaPedido` | L3 |


</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "Crear.*Factura|CrearFactura|GenerarFactura" in "d:\dialfa new\spisa\SPISA.Presentacion" ‚Ä¢ 3 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `SPISA.Presentacion\frmPrincipal.cs` | `GenerarFactura();` | L116 |
| `SPISA.Presentacion\frmPrincipal.cs` | `private void GenerarFactura()` | L554 |
| `SPISA.Presentacion\frmPrincipal.cs` | `Factura f = ucNP.NotaPedido.GenerarFactura();` | L582 |


</details>
</tool-use>

---

Perfecto, encontr√© los archivos relevantes. D√©jame leer el c√≥digo de NotaPedido (el control de pedidos) y el frmPrincipal:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa\SPISA.Presentacion\UC\NotaPedido.cs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa\SPISA.Presentacion\frmPrincipal.cs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "class.*NotaPedido|class.*Pedido" in "d:\dialfa new\spisa\SPISA_LogicaDeNegocios" ‚Ä¢ 8 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `public partial class NotaPedido_Items : global::System.Data.Objects.DataClasses.EntityObject` | L2827 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `public partial class NotaPedidos : global::System.Data.Objects.DataClasses.EntityObject` | L3042 |
| `SPISA_LogicaDeNegocios\NotaPedido.cs` | `public class NotaPedido` | L19 |
| `SPISA_LogicaDeNegocios\NotaPedido_Item.cs` | `public class NotaPedido_Item` | L7 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `public partial class NotaPedido_Items : global::System.Data.Objects.DataClasses.EntityObject` | L4828 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `public partial class NotaPedidos : global::System.Data.Objects.DataClasses.EntityObject` | L5043 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `public partial class NotaPedido_Items : global::System.Data.Objects.DataClasses.EntityObject` | L4805 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `public partial class NotaPedidos : global::System.Data.Objects.DataClasses.EntityObject` | L5020 |


</details>
</tool-use>

---

Ahora d√©jame leer la clase NotaPedido en la capa de l√≥gica de negocios para entender los estados y reglas:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa\SPISA_LogicaDeNegocios\NotaPedido.cs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "class.*Factura[^s]" in "d:\dialfa new\spisa\SPISA_LogicaDeNegocios" ‚Ä¢ 0 matches</summary>

Output mode: content


_No matches found_

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "FueImpresa|FueCancelada|EstadoPedido|Estado" in "d:\dialfa new\spisa\SPISA_LogicaDeNegocios" ‚Ä¢ 87 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `/// <param name="fueImpresa">Initial value of FueImpresa.</param>` | L2412 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `/// <param name="fueCancelada">Initial value of FueCancelada.</param>` | L2413 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `facturas.FueImpresa = fueImpresa;` | L2421 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `facturas.FueCancelada = fueCancelada;` | L2422 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `/// There are no comments for Property FueImpresa in the schema.` | L2519 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `public bool FueImpresa` | L2523 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `return this._FueImpresa;` | L2527 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.OnFueImpresaChanging(value);` | L2531 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.ReportPropertyChanging("FueImpresa");` | L2532 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this._FueImpresa = global::System.Data.Objects.DataClasses.StructuralObject.SetValidValue(value);` | L2533 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.ReportPropertyChanged("FueImpresa");` | L2534 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.OnFueImpresaChanged();` | L2535 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `private bool _FueImpresa;` | L2538 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `partial void OnFueImpresaChanging(bool value);` | L2539 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `partial void OnFueImpresaChanged();` | L2540 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `/// There are no comments for Property FueCancelada in the schema.` | L2565 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `public bool FueCancelada` | L2569 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `return this._FueCancelada;` | L2573 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.OnFueCanceladaChanging(value);` | L2577 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.ReportPropertyChanging("FueCancelada");` | L2578 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this._FueCancelada = global::System.Data.Objects.DataClasses.StructuralObject.SetValidValue(value);` | L2579 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.ReportPropertyChanged("FueCancelada");` | L2580 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `this.OnFueCanceladaChanged();` | L2581 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `private bool _FueCancelada;` | L2584 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `partial void OnFueCanceladaChanging(bool value);` | L2585 |
| `SPISA_LogicaDeNegocios\EntityModel.Designer.cs` | `partial void OnFueCanceladaChanged();` | L2586 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `/// <param name="fueImpresa">Initial value of FueImpresa.</param>` | L4390 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `/// <param name="fueCancelada">Initial value of FueCancelada.</param>` | L4391 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `facturas.FueImpresa = fueImpresa;` | L4399 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `facturas.FueCancelada = fueCancelada;` | L4400 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `/// There are no comments for Property FueImpresa in the schema.` | L4497 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `public bool FueImpresa` | L4501 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `return this._FueImpresa;` | L4505 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.OnFueImpresaChanging(value);` | L4509 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.ReportPropertyChanging("FueImpresa");` | L4510 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this._FueImpresa = global::System.Data.Objects.DataClasses.StructuralObject.SetValidValue(value);` | L4511 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.ReportPropertyChanged("FueImpresa");` | L4512 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.OnFueImpresaChanged();` | L4513 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `private bool _FueImpresa;` | L4516 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `partial void OnFueImpresaChanging(bool value);` | L4517 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `partial void OnFueImpresaChanged();` | L4518 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `/// There are no comments for Property FueCancelada in the schema.` | L4543 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `public bool FueCancelada` | L4547 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `return this._FueCancelada;` | L4551 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.OnFueCanceladaChanging(value);` | L4555 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.ReportPropertyChanging("FueCancelada");` | L4556 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this._FueCancelada = global::System.Data.Objects.DataClasses.StructuralObject.SetValidValue(value);` | L4557 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.ReportPropertyChanged("FueCancelada");` | L4558 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `this.OnFueCanceladaChanged();` | L4559 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `private bool _FueCancelada;` | L4562 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `partial void OnFueCanceladaChanging(bool value);` | L4563 |
| `SPISA_LogicaDeNegocios\_SpisaEntityModel.Designer.cs` | `partial void OnFueCanceladaChanged();` | L4564 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `/// <param name="fueImpresa">Initial value of FueImpresa.</param>` | L4413 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `/// <param name="fueCancelada">Initial value of FueCancelada.</param>` | L4414 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `facturas.FueImpresa = fueImpresa;` | L4422 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `facturas.FueCancelada = fueCancelada;` | L4423 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `/// There are no comments for Property FueImpresa in the schema.` | L4520 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `public bool FueImpresa` | L4524 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `return this._FueImpresa;` | L4528 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.OnFueImpresaChanging(value);` | L4532 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.ReportPropertyChanging("FueImpresa");` | L4533 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this._FueImpresa = global::System.Data.Objects.DataClasses.StructuralObject.SetValidValue(value);` | L4534 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.ReportPropertyChanged("FueImpresa");` | L4535 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.OnFueImpresaChanged();` | L4536 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `private bool _FueImpresa;` | L4539 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `partial void OnFueImpresaChanging(bool value);` | L4540 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `partial void OnFueImpresaChanged();` | L4541 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `/// There are no comments for Property FueCancelada in the schema.` | L4566 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `public bool FueCancelada` | L4570 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `return this._FueCancelada;` | L4574 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.OnFueCanceladaChanging(value);` | L4578 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.ReportPropertyChanging("FueCancelada");` | L4579 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this._FueCancelada = global::System.Data.Objects.DataClasses.StructuralObject.SetValidValue(value);` | L4580 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.ReportPropertyChanged("FueCancelada");` | L4581 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `this.OnFueCanceladaChanged();` | L4582 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `private bool _FueCancelada;` | L4585 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `partial void OnFueCanceladaChanging(bool value);` | L4586 |
| `SPISA_LogicaDeNegocios\SPISAEntitiesModel.Designer.cs` | `partial void OnFueCanceladaChanged();` | L4587 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `public bool FueImpresa` | L95 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `public bool FueCancelada` | L100 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `public static DataSet Buscar(SqlInt32 NumeroFactura, string RazonSocial, SqlDateTime FechaEmision, string Observaciones, SqlInt32 FueImpresa, SqlInt32 FueCancelada)` | L114 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `Logger.Append(Consts.Facturas_Buscar, new Object[] \{ "NumeroFactura", NumeroFactura, "RazonSocial", RazonSocial, "FechaEmision", FechaEmision.ToString(), "Observaciones", Observaciones, "FueImpresa", FueImpresa, "FueCancelada", FueCancelada \}, ds.Tables[0].Rows.Count + " rows");` | L134 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `f._fueImpresa = Convert.ToBoolean(dr["FueImpresa"]);` | L250 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `f._fueCancelada = Convert.ToBoolean(dr["FueCancelada"]);` | L251 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `f._fueImpresa = Convert.ToBoolean(dataReader["FueImpresa"]);` | L352 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `f._fueCancelada = Convert.ToBoolean(dataReader["FueCancelada"]);` | L353 |
| `SPISA_LogicaDeNegocios\Factura.cs` | `if (this.FueCancelada) throw new Exception("La factura ha sido cancelada y no puede imprimirse");` | L388 |


</details>
</tool-use>

---

Ahora d√©jame ver el archivo de Factura.cs para entender mejor los estados:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa\SPISA_LogicaDeNegocios\Factura.cs</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "groupPedidoActual|groupFacturaActual" in "d:\dialfa new\spisa\SPISA.Presentacion" ‚Ä¢ 39 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.ModificarTabSeleccionado("Factura \""  + _factura.Cliente.RazonSocial.ToString() + "\"", "factura_" + _factura.Id.ToString(), "groupFacturaActualAlmacenadaImpresa", true);` | L234 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaSinRemito",` | L240 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaConRemito",` | L241 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaSinRemito",` | L242 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaConRemito"` | L243 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaSinRemito",` | L294 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaConRemito",` | L295 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaSinRemito",` | L296 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaConRemito"` | L297 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("factura_" + f.Id.ToString(), "Factura \"" + f.Cliente.RazonSocial + "\"", "groupFacturaActualAlmacenadaImpresa", ucFactura)].Selected = true;` | L372 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("factura_" + f.Id.ToString(), "Factura \"" + f.Cliente.RazonSocial + "\"", "groupFacturaActualAlmacenada", ucFactura)].Selected = true;` | L377 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaSinRemito",` | L413 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaConRemito",` | L414 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaSinRemito",` | L415 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaConRemito"` | L416 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("factura_" + np.IdNotaPedido, "Nueva Factura *", "groupFacturaActual", ucFactura)].Selected = true;` | L589 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.AgregarTab("", "Nuevo Pedido *", "groupPedidoActualNoAlmacenado", ucNp);` | L636 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.AgregarTab("", "Nueva Factura *", "groupFacturaActual", ucFactura);` | L649 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaSinRemito",` | L666 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaConRemito",` | L667 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaSinRemito",` | L668 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaConRemito"` | L669 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaSinRemito",` | L733 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaConRemito",` | L734 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaSinRemito",` | L735 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaConRemito"` | L736 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaSinRemito",` | L783 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoSinFacturaConRemito",` | L784 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaSinRemito",` | L785 |
| `SPISA.Presentacion\frmPrincipal.cs` | `"groupPedidoActualAlmacenadoConFacturaConRemito"` | L786 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.ModificarTabSeleccionado("Factura \"" + f.Cliente.RazonSocial + "\"", "factura_" + f.Id.ToString(), "groupFacturaActualAlmacenadaImpresa", true);` | L815 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.ModificarTabSeleccionado("Factura \"" + f.Cliente.RazonSocial + "\"", "factura_" + f.Id.ToString(), "groupFacturaActualAlmacenada", true);` | L817 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("factura_" + f.Id.ToString(), "Factura \"" + f.Cliente.RazonSocial + "\"", "groupFacturaActualAlmacenadaImpresa", ucFactura)].Selected = true;` | L861 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("factura_" + f.Id.ToString(), "Factura \"" + f.Cliente.RazonSocial + "\"", "groupFacturaActualAlmacenada", ucFactura)].Selected = true;` | L866 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("pedido_" + np.IdNotaPedido, "Pedido \"" + np.Cliente.RazonSocial + "\"", "groupPedidoActualAlmacenadoSinFacturaConRemito", ucNp)].Selected = true;` | L911 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("pedido_" + np.IdNotaPedido, "Pedido \"" + np.Cliente.RazonSocial + "\"", "groupPedidoActualAlmacenadoConFacturaSinRemito", ucNp)].Selected = true;` | L917 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("pedido_" + np.IdNotaPedido, "Pedido \"" + np.Cliente.RazonSocial + "\"", "groupPedidoActualAlmacenadoConFacturaSinRemito", ucNp)].Selected = true;` | L922 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("pedido_" + np.IdNotaPedido, "Pedido #" + np.NumeroOrden, "groupPedidoActualAlmacenadoConFacturaConRemito", ucNp)].Selected = true;` | L930 |
| `SPISA.Presentacion\frmPrincipal.cs` | `frm.TabControl.Tabs[frm.AgregarTab("pedido_" + np.IdNotaPedido, "Pedido #" + np.NumeroOrden, "groupPedidoActualAlmacenadoConFacturaConRemito", ucNp)].Selected = true;` | L934 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ahora tengo una buena comprensi√≥n del sistema. D√©jame buscar el archivo XML con los grupos de la explorer bar para entender los contextos de los botones:</details></think>

---

Ahora d√©jame ver el archivo XML con los grupos de configuraci√≥n de botones:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa\SPISA.Presentacion\ExplorerBarGroups.xml</summary>

</details>
</tool-use>

---

Perfecto. Ahora tengo una visi√≥n completa de la l√≥gica del sistema antiguo. D√©jame analizar y documentar mis hallazgos:

## An√°lisis de la L√≥gica de Botones en el Sistema Antiguo SPISA

Despu√©s de investigar el c√≥digo fuente del sistema antiguo, he identificado la l√≥gica completa de estados y botones para pedidos, facturas y remitos:

### **Estados de un Pedido (NotaPedido)**

El sistema maneja diferentes estados contextuales de un pedido bas√°ndose en:
1. **Si est√° almacenado o no en la BD**
2. **Si tiene factura asociada**
3. **Si tiene remito asociado**
4. **Si la factura fue impresa**

#### **Estados Posibles:**

1. **`groupPedidoActualNoAlmacenado`** - Pedido nuevo, no guardado
   - Botones: `Almacenar Pedido`

2. **`groupPedidoActualAlmacenadoSinFacturaSinRemito`** - Pedido guardado sin factura ni remito
   - Botones: `Almacenar Pedido`, `Generar Factura`, `Generar Remito`

3. **`groupPedidoActualAlmacenadoConFacturaSinRemito`** - Pedido guardado con factura pero sin remito
   - Botones: `Almacenar Pedido`, `Visualizar Factura`, `Generar Remito`

4. **`groupPedidoActualAlmacenadoSinFacturaConRemito`** - Pedido guardado con remito pero sin factura
   - Botones: `Almacenar Pedido`, `Generar Factura`, `Visualizar Remito`

5. **`groupPedidoActualAlmacenadoConFacturaConRemito`** - Pedido guardado con factura y remito
   - Botones: `Almacenar Pedido`, `Visualizar Factura`, `Visualizar Remito`

### **Estados de una Factura**

```108:110:d:\dialfa new\spisa\SPISA_LogicaDeNegocios\Factura.cs
        public bool FueImpresa
        {
            get { return _fueImpresa; }
            set { _fueImpresa = value; }
        }
        public bool FueCancelada
        {
            get { return _fueCancelada; }
            set { _fueCancelada = value; }
        }
```

1. **`groupFacturaActual`** - Factura nueva, no guardada
   - Botones: `Almacenar Factura`

2. **`groupFacturaActualAlmacenada`** - Factura guardada pero NO impresa
   - Botones: `Almacenar Factura`, `Cancelar Factura`, `Visualizar Nota de Pedido`, `Imprimir Factura`

3. **`groupFacturaActualAlmacenadaImpresa`** - Factura guardada y YA impresa
   - Botones: `Almacenar Factura`, `Cancelar Factura`, `Visualizar Nota de Pedido`, `Imprimir Copia de Factura`
   - **IMPORTANTE**: Cuando una factura es impresa, el pedido asociado se vuelve NO MODIFICABLE

4. **`groupFacturaActualCancelada`** - Factura cancelada
   - Botones: `Visualizar Nota de Pedido`

### **L√≥gica de Negocio Cr√≠tica**

#### **Crear Factura desde Pedido:**

```554:600:d:\dialfa new\spisa\SPISA.Presentacion\frmPrincipal.cs
        private void GenerarFactura()
        {
            try
            {
                frmContainer frm = frmContainer.crearContainer(this.explorerBar);

                if (frm != null)
                {
                    UcNotaPedido ucNP = (UcNotaPedido)frm.TraerUserControlVisible();
                    NotaPedido np = ucNP.NotaPedido;

                    
                    //verificamos que ya no se haya hecho click en "facturar"
                    if (frm.TabControl.Tabs.Exists("factura_" + np.IdNotaPedido))
                    {
                        frm.TabControl.Tabs["factura_" + np.IdNotaPedido].Selected = true;
                    }
                    else
                    {
                        int check = ucNP.BeforeCloseCheck();
                        if (check == 1)
                        {
                            ucNP.Guardar();
                            frm.ModificarTabSeleccionado("Pedido \"" + np.Cliente.RazonSocial + "\"");
                        }
                        if (check != 3)
                        {
                            Decimal valorDolar = Convert.ToDecimal(frmPrincipal.valorDolar);
                            Factura f = ucNP.NotaPedido.GenerarFactura();

                            f.ValorDolar = valorDolar;

                            if (f != null)
                            {
                                UcFactura ucFactura = new UcFactura(f);
                                frm.TabControl.Tabs[frm.AgregarTab("factura_" + np.IdNotaPedido, "Nueva Factura *", "groupFacturaActual", ucFactura)].Selected = true;
                                ucFactura.SetInitialFocus();
                            }
                        }
                    }
                }
            }
            catch (Exception ex)
            {
                throw ex;
            }
        }
```

- Antes de generar factura, verifica si el pedido tiene cambios sin guardar
- Genera una factura con los mismos items del pedido
- La factura hereda el cliente y art√≠culos del pedido

#### **Imprimir Factura:**

```221:275:d:\dialfa new\spisa\SPISA.Presentacion\frmPrincipal.cs
        private void ImprimirFactura()
        {
            try
            {
                
                frmContainer frm = frmContainer.crearContainer(this.explorerBar);
                UcFactura ucFactura = (UcFactura)frm.TraerUserControlVisible();
                
                int idFactura = ucFactura.Imprimir();
                Factura _factura = Factura.TraerFacturaPorID(idFactura);

                if (_factura != null)
                {
                    frm.ModificarTabSeleccionado("Factura \""  + _factura.Cliente.RazonSocial.ToString() + "\"", "factura_" + _factura.Id.ToString(), "groupFacturaActualAlmacenadaImpresa", true);
                    ucFactura.SetearFormularioNoModificable();

                    int existeFacturaORemito = DeterminarExistenciaDeFacturaORemito(_factura.NotaPedido.IdNotaPedido);

                    string[] options = new string[] { 
                                            "groupPedidoActualAlmacenadoSinFacturaSinRemito",
                                            "groupPedidoActualAlmacenadoSinFacturaConRemito",
                                            "groupPedidoActualAlmacenadoConFacturaSinRemito",
                                            "groupPedidoActualAlmacenadoConFacturaConRemito"
                    
                                        };

                    if (frm.TabControl.Tabs.Exists("pedido_" + _factura.NotaPedido.IdNotaPedido))
                    {
                        frm.TabControl.Tabs["pedido_" + _factura.NotaPedido.IdNotaPedido].Tag = options[existeFacturaORemito];

                        BaseControl bc = (BaseControl)frm.TabControl.Tabs["pedido_" + _factura.NotaPedido.IdNotaPedido].TabPage.Controls[0];
                        bc.SetearFormularioNoModificable();
                    }


                    Remito r = Remito.TraerRemitoPorIdNotaPedido(_factura.NotaPedido.IdNotaPedido);

                    if (r != null)
                    {
                        if (frm.TabControl.Tabs.Exists("remito_" + r.Id))
                        {
                            BaseControl bc = (BaseControl)frm.TabControl.Tabs["remito_" + r.Id].TabPage.Controls[0];
                            bc.SetearFormularioNoModificable();

                            frm.TabControl.Tabs["remito_" + r.Id].Tag = "groupRemitoActualNoModificable";
                        }
                    }
                }
                
            }
            catch (Exception ex)
            {
                MessageBox.Show("Ha ocurrido un error al intentar imprimir la Factura. Consulte el Log para mas detalles.", "Error al Imprimir Factura", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
```

- **CR√çTICO**: Cuando se imprime una factura:
  - La factura pasa a estado "Impresa" y se vuelve NO MODIFICABLE
  - El pedido asociado tambi√©n se vuelve NO MODIFICABLE
  - El remito asociado (si existe) tambi√©n se vuelve NO MODIFICABLE
  - Se debita el stock de art√≠culos
  - Se registra el movimiento en cuenta corriente del cliente

#### **Cancelar Factura:**

```277:319:d:\dialfa new\spisa\SPISA.Presentacion\frmPrincipal.cs
        private void CancelarFactura()
        {
            try
            {
                string[] grupos = { "groupFavoritos", "groupGestion" };
                
                frmContainer frm = frmContainer.crearContainer(this.explorerBar);
                UcFactura ucFactura = (UcFactura)frm.TraerUserControlVisible();
                Factura f = ucFactura.Factura;

                ucFactura.Cancelar();

                
                /* cambios desde aqui */
                int existeFacturaORemito = DeterminarExistenciaDeFacturaORemito(f.NotaPedido.IdNotaPedido);

                string[] options = new string[] { 
                                                "groupPedidoActualAlmacenadoSinFacturaSinRemito",
                                                "groupPedidoActualAlmacenadoSinFacturaConRemito",
                                                "groupPedidoActualAlmacenadoConFacturaSinRemito",
                                                "groupPedidoActualAlmacenadoConFacturaConRemito"
                        
                                            };

                if (frm.TabControl.Tabs.Exists("pedido_" + f.NotaPedido.IdNotaPedido))
                {
                    frm.TabControl.Tabs["pedido_" + f.NotaPedido.IdNotaPedido].Tag = options[existeFacturaORemito];

                }

                frm.TabControl.Tabs.Remove(frm.TabControl.SelectedTab);
                /*cambios hasta aqui */
                if (frm.TabControl.Tabs.Count == 0)
                {
                    frm.Close();
                    ExplorerBarController.FillExplorerBar(grupos, explorerBar);
                }
            }
            catch (Exception ex)
            {
                MessageBox.Show("Ha ocurrido un error al cancelar la Factura. Consulte el Log para mas detalles.", "Error al Cancelar Factura", MessageBoxButtons.OK, MessageBoxIcon.Error);
            }
        }
```

- Marca la factura como cancelada en la BD
- Actualiza el estado del pedido asociado
- Cierra la pesta√±a de la factura

#### **Validaciones al Guardar Pedido:**

```390:445:d:\dialfa new\spisa\SPISA.Presentacion\UC\NotaPedido.cs
        private bool VerificarCampos()
        {
            errorProvider.Clear();
            detallesCliente.QuitarError();

            bool ok = true;
            bool stockCritico = false;
            //Verificamos que se haya seleccionado algun cliente
            if (detallesCliente.Cliente == null)
            {
                detallesCliente.EstablecerError();
                ok = false;
                
            }


            bool existenItemsCargados = false;
            foreach (Infragistics.Win.UltraWinGrid.UltraGridRow dr in ugArticulos.Rows)
            {
                Articulo a = Articulo.TraerArticuloPorCodigo(dr.Cells["Codigo"].Value.ToString());

                if (Convert.ToBoolean((dr.Cells["StockCritico"].Value != DBNull.Value ? dr.Cells["StockCritico"].Value : false)) == true) stockCritico = true;

                if (a != null)
                {
                    existenItemsCargados = true;
                }
            }

            if (!existenItemsCargados)
            {
                errorProvider.SetError(ugArticulos, "Deber√° agregar al menos un item a la lista...");
                ok = false;
            }

            if (ok)
                if (stockCritico)
                {
                    AppSettingsReader reader = new AppSettingsReader();
                    int option = (int)reader.GetValue("StockCritico", typeof(int));

                    switch (option)
                    {
                        case 1:
                            DialogResult dr = MessageBox.Show("Existen uno o mas items cuya cantidad supera la que existe en stock. ¬øDesea Continuar?", "Stock Cr√≠tico", MessageBoxButtons.YesNo, MessageBoxIcon.Question, MessageBoxDefaultButton.Button2);
                            if (dr == DialogResult.No) ok = false;
                            break;
                        case 2:
                            MessageBox.Show("Existen uno o mas items cuya cantidad supera la que existe en stock. No puede continuar", "Stock Cr√≠tico", MessageBoxButtons.OK, MessageBoxIcon.Error);
                            ok = false;
                            break;
                    }
                }

            return ok; 
        }
```

- Debe tener al menos un cliente seleccionado
- Debe tener al menos un art√≠culo en la lista
- Verifica stock cr√≠tico (cantidad pedida > stock disponible)

### **Resumen de Reglas de Botones para la Nueva Aplicaci√≥n**

Con base en la imagen que mostraste y el c√≥digo del sistema antiguo:

#### **Bot√≥n "Guardar Cambios"**
- Debe estar habilitado siempre que el pedido NO est√© vinculado a una factura impresa
- Si la factura asociada fue impresa ‚Üí el pedido debe ser de solo lectura
- Validar: cliente seleccionado + al menos 1 art√≠culo

#### **Bot√≥n "Crear Factura"**
- Habilitado si:
  - El pedido est√° guardado (tiene ID)
  - NO existe una factura para este pedido, o la factura existente fue cancelada
- Antes de crear, verificar si hay cambios sin guardar y preguntar si desea guardarlos

#### **Bot√≥n "Cancelar Pedido"**
- Solo disponible si el pedido NO tiene factura impresa asociada
- Si tiene factura sin imprimir ‚Üí permitir cancelar
- Si tiene factura impresa ‚Üí NO permitir cancelar el pedido

#### **Bot√≥n "Eliminar"**
- Similar a "Cancelar Pedido"
- NO permitir eliminar si tiene factura impresa
- Confirmar acci√≥n con el usuario

#### **Bot√≥n "Volver"**
- Siempre habilitado
- Si hay cambios sin guardar ‚Üí preguntar: "¬øDesea guardar los cambios?"

### **Estados que afectan los Botones:**

```typescript
interface PedidoEstado {
  id: number | null;           // null = nuevo, number = guardado
  tieneFactura: boolean;
  facturaImpresa: boolean;
  facturaCancelada: boolean;
  tieneRemito: boolean;
  fueModificado: boolean;      // para el "*" en el t√≠tulo
}

// L√≥gica de habilitaci√≥n:
const botones = {
  guardar: !pedido.facturaImpresa,
  crearFactura: pedido.id !== null && (!pedido.tieneFactura || pedido.facturaCancelada),
  cancelar: !pedido.facturaImpresa,
  eliminar: !pedido.facturaImpresa && !pedido.tieneFactura,
  volver: true  // siempre habilitado
}
```

¬øQuieres que implemente esta l√≥gica en el sistema nuevo? Necesitar√≠a ver el c√≥digo del componente de pedidos en el sistema nuevo para adaptarlo correctamente.

---

_**User (2025-10-29 10:45Z)**_

vamos a documentar esto en un archivo MD "button_Statuses". 

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
El usuario quiere que documente todo lo que he investigado en un archivo markdown llamado "button_Statuses" (aunque la memoria dice que no debo crear archivos MD a menos que me lo pidan expl√≠citamente, aqu√≠ me lo est√° pidiendo directamente).

Voy a crear un archivo MD completo y estructurado con toda la informaci√≥n sobre la l√≥gica de botones y estados del sistema antiguo.</details></think>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\BUTTON_STATUSES.md</summary>

**Chunk 1**
Lines added: 692, lines removed: 1

```diff
@@ -1,1 +1,692 @@
- 
+ # L√≥gica de Estados y Botones - Sistema SPISA
+ 
+ ## Resumen Ejecutivo
+ 
+ Este documento detalla la l√≥gica de estados y habilitaci√≥n de botones del sistema SPISA basado en el an√°lisis del c√≥digo fuente del sistema legacy (SPISA Gesti√≥n 2007).
+ 
+ ## Tabla de Contenidos
+ 
+ 1. [Estados de Pedidos](#estados-de-pedidos)
+ 2. [Estados de Facturas](#estados-de-facturas)
+ 3. [Estados de Remitos](#estados-de-remitos)
+ 4. [L√≥gica de Botones por Contexto](#l√≥gica-de-botones-por-contexto)
+ 5. [Reglas de Negocio Cr√≠ticas](#reglas-de-negocio-cr√≠ticas)
+ 6. [Implementaci√≥n Recomendada](#implementaci√≥n-recomendada)
+ 
+ ---
+ 
+ ## Estados de Pedidos
+ 
+ Un pedido (NotaPedido) tiene diferentes estados contextuales que determinan qu√© botones est√°n disponibles:
+ 
+ ### Estado 1: Pedido Nuevo (No Almacenado)
+ **Tag XML**: &#96;groupPedidoActualNoAlmacenado&#96;
+ 
+ - **Condici√≥n**: Pedido creado pero no guardado en la BD
+ - **Caracter√≠sticas**:
+   - IdNotaPedido = -1
+   - No tiene factura asociada
+   - No tiene remito asociado
+ - **Botones Disponibles**:
+   - ‚úÖ Almacenar Pedido
+   - ‚úÖ Volver
+ 
+ ### Estado 2: Pedido Almacenado Sin Factura Sin Remito
+ **Tag XML**: &#96;groupPedidoActualAlmacenadoSinFacturaSinRemito&#96;
+ 
+ - **Condici√≥n**: Pedido guardado, sin documentos asociados
+ - **Caracter√≠sticas**:
+   - IdNotaPedido &gt; 0
+   - No tiene factura
+   - No tiene remito
+   - Es completamente modificable
+ - **Botones Disponibles**:
+   - ‚úÖ Guardar Cambios
+   - ‚úÖ Generar Factura
+   - ‚úÖ Generar Remito
+   - ‚úÖ Eliminar/Cancelar
+   - ‚úÖ Volver
+ 
+ ### Estado 3: Pedido Almacenado Con Factura Sin Remito
+ **Tag XML**: &#96;groupPedidoActualAlmacenadoConFacturaSinRemito&#96;
+ 
+ - **Condici√≥n**: Pedido con factura asociada pero sin remito
+ - **Caracter√≠sticas**:
+   - IdNotaPedido &gt; 0
+   - Tiene factura (impresa o no)
+   - No tiene remito
+   - **IMPORTANTE**: Si la factura fue impresa, el pedido es SOLO LECTURA
+ - **Botones Disponibles**:
+   - ‚úÖ Guardar Cambios (solo si factura NO impresa)
+   - ‚úÖ Visualizar Factura
+   - ‚úÖ Generar Remito
+   - ‚ùå Eliminar (si factura impresa)
+   - ‚úÖ Volver
+ 
+ ### Estado 4: Pedido Almacenado Sin Factura Con Remito
+ **Tag XML**: &#96;groupPedidoActualAlmacenadoSinFacturaConRemito&#96;
+ 
+ - **Condici√≥n**: Pedido con remito pero sin factura
+ - **Caracter√≠sticas**:
+   - IdNotaPedido &gt; 0
+   - No tiene factura
+   - Tiene remito
+ - **Botones Disponibles**:
+   - ‚úÖ Guardar Cambios
+   - ‚úÖ Generar Factura
+   - ‚úÖ Visualizar Remito
+   - ‚úÖ Volver
+ 
+ ### Estado 5: Pedido Almacenado Con Factura Con Remito
+ **Tag XML**: &#96;groupPedidoActualAlmacenadoConFacturaConRemito&#96;
+ 
+ - **Condici√≥n**: Pedido con factura y remito asociados
+ - **Caracter√≠sticas**:
+   - IdNotaPedido &gt; 0
+   - Tiene factura
+   - Tiene remito
+   - **IMPORTANTE**: Si la factura fue impresa, TODOS los documentos son SOLO LECTURA
+ - **Botones Disponibles**:
+   - ‚úÖ Guardar Cambios (solo si factura NO impresa)
+   - ‚úÖ Visualizar Factura
+   - ‚úÖ Visualizar Remito
+   - ‚ùå Eliminar (si factura impresa)
+   - ‚úÖ Volver
+ 
+ ---
+ 
+ ## Estados de Facturas
+ 
+ ### Propiedades de Estado en la BD
+ 
+ &#96;&#96;&#96;csharp
+ public bool FueImpresa { get; set; }    // ¬øLa factura fue impresa?
+ public bool FueCancelada { get; set; }  // ¬øLa factura fue cancelada?
+ public bool EsNotaDeCredito { get; set; } // ¬øEs nota de cr√©dito?
+ &#96;&#96;&#96;
+ 
+ ### Estado 1: Factura Nueva (No Almacenada)
+ **Tag XML**: &#96;groupFacturaActual&#96;
+ 
+ - **Condici√≥n**: Factura generada desde pedido pero no guardada
+ - **Caracter√≠sticas**:
+   - IdFactura = -1
+   - FueImpresa = false
+   - FueCancelada = false
+ - **Botones Disponibles**:
+   - ‚úÖ Almacenar Factura
+   - ‚úÖ Volver
+ 
+ ### Estado 2: Factura Almacenada (No Impresa)
+ **Tag XML**: &#96;groupFacturaActualAlmacenada&#96;
+ 
+ - **Condici√≥n**: Factura guardada pero a√∫n no impresa
+ - **Caracter√≠sticas**:
+   - IdFactura &gt; 0
+   - FueImpresa = false
+   - FueCancelada = false
+   - Es completamente modificable
+ - **Botones Disponibles**:
+   - ‚úÖ Guardar Cambios
+   - ‚úÖ Cancelar Factura
+   - ‚úÖ Visualizar Nota de Pedido
+   - ‚úÖ Imprimir Factura
+   - ‚úÖ Volver
+ 
+ ### Estado 3: Factura Impresa
+ **Tag XML**: &#96;groupFacturaActualAlmacenadaImpresa&#96;
+ 
+ - **Condici√≥n**: Factura ya fue impresa
+ - **Caracter√≠sticas**:
+   - IdFactura &gt; 0
+   - FueImpresa = true
+   - FueCancelada = false
+   - **SOLO LECTURA** - No se puede modificar
+   - Stock ya fue debitado
+   - Movimiento en cuenta corriente registrado
+ - **Botones Disponibles**:
+   - ‚ùå Guardar Cambios (formulario bloqueado)
+   - ‚úÖ Cancelar Factura (requiere confirmaci√≥n especial)
+   - ‚úÖ Visualizar Nota de Pedido
+   - ‚úÖ Imprimir Copia de Factura
+   - ‚úÖ Volver
+ 
+ ### Estado 4: Factura Cancelada
+ **Tag XML**: &#96;groupFacturaActualCancelada&#96;
+ 
+ - **Condici√≥n**: Factura cancelada
+ - **Caracter√≠sticas**:
+   - IdFactura &gt; 0
+   - FueCancelada = true
+   - **SOLO LECTURA** - No se puede modificar ni reactivar
+ - **Botones Disponibles**:
+   - ‚úÖ Visualizar Nota de Pedido
+   - ‚úÖ Volver
+ 
+ ---
+ 
+ ## Estados de Remitos
+ 
+ ### Estado 1: Remito Nuevo
+ **Tag XML**: &#96;groupRemitoActual&#96;
+ 
+ - **Condici√≥n**: Remito generado pero no guardado
+ - **Botones Disponibles**:
+   - ‚úÖ Almacenar Remito
+   - ‚úÖ Volver
+ 
+ ### Estado 2: Remito Almacenado
+ **Tag XML**: &#96;groupRemitoActualAlmacenado&#96;
+ 
+ - **Condici√≥n**: Remito guardado, factura NO impresa
+ - **Botones Disponibles**:
+   - ‚úÖ Guardar Cambios
+   - ‚úÖ Visualizar Nota de Pedido
+   - ‚úÖ Imprimir Remito
+   - ‚úÖ Volver
+ 
+ ### Estado 3: Remito No Modificable
+ **Tag XML**: &#96;groupRemitoActualNoModificable&#96;
+ 
+ - **Condici√≥n**: Factura asociada fue impresa
+ - **Caracter√≠sticas**:
+   - **SOLO LECTURA**
+ - **Botones Disponibles**:
+   - ‚ùå Guardar Cambios (bloqueado)
+   - ‚úÖ Visualizar Nota de Pedido
+   - ‚úÖ Volver
+ 
+ ---
+ 
+ ## L√≥gica de Botones por Contexto
+ 
+ ### Pantalla de Pedidos
+ 
+ #### Bot√≥n "Guardar Cambios"
+ 
+ &#96;&#96;&#96;typescript
+ const habilitarGuardarPedido = (pedido: Pedido) =&gt; {
+   // NO permitir guardar si la factura asociada fue impresa
+   if (pedido.factura?.fueImpresa) {
+     return false;
+   }
+   
+   // Permitir en cualquier otro caso
+   return true;
+ };
+ &#96;&#96;&#96;
+ 
+ **Validaciones antes de guardar:**
+ 1. ‚úÖ Debe tener un cliente seleccionado
+ 2. ‚úÖ Debe tener al menos 1 art√≠culo en el carrito
+ 3. ‚ö†Ô∏è Advertir si alg√∫n art√≠culo tiene cantidad mayor al stock disponible
+    - Seg√∫n configuraci√≥n: solo advertir o bloquear
+ 
+ #### Bot√≥n "Crear Factura"
+ 
+ &#96;&#96;&#96;typescript
+ const habilitarCrearFactura = (pedido: Pedido) =&gt; {
+   // El pedido debe estar guardado
+   if (!pedido.id) {
+     return false;
+   }
+   
+   // No debe tener factura activa (no cancelada)
+   if (pedido.factura &amp;&amp; !pedido.factura.fueCancelada) {
+     return false;
+   }
+   
+   return true;
+ };
+ &#96;&#96;&#96;
+ 
+ **Flujo al crear factura:**
+ 1. Verificar si hay cambios sin guardar en el pedido
+ 2. Si hay cambios ‚Üí Preguntar: "¬øDesea guardar los cambios antes de generar la factura?"
+ 3. Generar la factura con los items del pedido
+ 4. Heredar: cliente, art√≠culos, descuento especial, observaciones
+ 
+ #### Bot√≥n "Cancelar/Eliminar Pedido"
+ 
+ &#96;&#96;&#96;typescript
+ const habilitarCancelarPedido = (pedido: Pedido) =&gt; {
+   // NO permitir si tiene factura impresa
+   if (pedido.factura?.fueImpresa) {
+     return false;
+   }
+   
+   return true;
+ };
+ &#96;&#96;&#96;
+ 
+ #### Bot√≥n "Volver"
+ 
+ &#96;&#96;&#96;typescript
+ const handleVolver = async (pedido: Pedido) =&gt; {
+   // Si hay cambios sin guardar
+   if (pedido.hasUnsavedChanges) {
+     const respuesta = await confirmar(
+       "¬øDesea guardar los cambios?",
+       { buttons: ["S√≠", "No", "Cancelar"] }
+     );
+     
+     if (respuesta === "S√≠") {
+       await guardarPedido();
+       navegarAtras();
+     } else if (respuesta === "No") {
+       navegarAtras();
+     }
+     // Si "Cancelar" ‚Üí no hacer nada
+   } else {
+     navegarAtras();
+   }
+ };
+ &#96;&#96;&#96;
+ 
+ ### Pantalla de Facturas
+ 
+ #### Bot√≥n "Guardar Cambios"
+ 
+ &#96;&#96;&#96;typescript
+ const habilitarGuardarFactura = (factura: Factura) =&gt; {
+   // NO permitir si ya fue impresa
+   if (factura.fueImpresa) {
+     return false;
+   }
+   
+   // NO permitir si fue cancelada
+   if (factura.fueCancelada) {
+     return false;
+   }
+   
+   return true;
+ };
+ &#96;&#96;&#96;
+ 
+ #### Bot√≥n "Imprimir Factura"
+ 
+ &#96;&#96;&#96;typescript
+ const habilitarImprimirFactura = (factura: Factura) =&gt; {
+   // Debe estar guardada
+   if (!factura.id) {
+     return false;
+   }
+   
+   // NO debe estar cancelada
+   if (factura.fueCancelada) {
+     return false;
+   }
+   
+   // Cambiar texto si ya fue impresa
+   // "Imprimir Factura" vs "Imprimir Copia"
+   
+   return true;
+ };
+ &#96;&#96;&#96;
+ 
+ **Efectos al imprimir factura:**
+ 1. ‚úÖ Marcar &#96;FueImpresa = true&#96; en la BD
+ 2. ‚úÖ Debitar stock de todos los art√≠culos
+ 3. ‚úÖ Registrar movimiento en cuenta corriente del cliente
+ 4. ‚úÖ Bloquear la factura (solo lectura)
+ 5. ‚úÖ Bloquear el pedido asociado (solo lectura)
+ 6. ‚úÖ Bloquear el remito asociado si existe (solo lectura)
+ 7. ‚úÖ Actualizar el estado visual de todos los documentos abiertos
+ 
+ #### Bot√≥n "Cancelar Factura"
+ 
+ &#96;&#96;&#96;typescript
+ const habilitarCancelarFactura = (factura: Factura) =&gt; {
+   // Debe estar guardada
+   if (!factura.id) {
+     return false;
+   }
+   
+   // NO debe estar ya cancelada
+   if (factura.fueCancelada) {
+     return false;
+   }
+   
+   return true;
+ };
+ &#96;&#96;&#96;
+ 
+ **Flujo al cancelar factura:**
+ 1. Confirmar acci√≥n con el usuario
+ 2. Si fue impresa:
+    - Revertir d√©bito de stock
+    - Eliminar movimiento de cuenta corriente
+    - Marcar &#96;FueCancelada = true&#96; (no se elimina de la BD)
+ 3. Si NO fue impresa:
+    - Opcionalmente eliminar de la BD
+    - O marcar como cancelada
+ 4. Actualizar estado del pedido asociado
+ 5. Cerrar la pesta√±a/ventana de la factura
+ 
+ ---
+ 
+ ## Reglas de Negocio Cr√≠ticas
+ 
+ ### üîí Regla 1: Inmutabilidad por Impresi√≥n
+ 
+ **Una vez que una factura es impresa, se vuelven INMUTABLES:**
+ - ‚ùå La factura
+ - ‚ùå El pedido asociado
+ - ‚ùå El remito asociado (si existe)
+ 
+ **Raz√≥n**: La impresi√≥n implica:
+ - D√©bito de stock en inventario
+ - Movimiento contable en cuenta corriente
+ - Documento fiscal generado
+ 
+ ### üîó Regla 2: Relaciones Entre Documentos
+ 
+ &#96;&#96;&#96;
+ Pedido (1) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Factura (0..1)
+    ‚îÇ
+    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫ Remito (0..1)
+ &#96;&#96;&#96;
+ 
+ - Un pedido puede tener m√°ximo 1 factura activa (no cancelada)
+ - Un pedido puede tener m√°ximo 1 remito
+ - Una factura SIEMPRE debe tener un pedido asociado
+ - Un remito SIEMPRE debe tener un pedido asociado
+ 
+ ### ‚ö†Ô∏è Regla 3: Stock Cr√≠tico
+ 
+ Al agregar art√≠culos al pedido, verificar si:
+ &#96;&#96;&#96;
+ cantidad_solicitada &gt; stock_disponible
+ &#96;&#96;&#96;
+ 
+ **Acciones seg√∫n configuraci√≥n:**
+ - **Opci√≥n 1**: Advertir pero permitir continuar
+ - **Opci√≥n 2**: Bloquear y no permitir continuar
+ 
+ **Indicador visual**: Resaltar la fila del art√≠culo con color de advertencia (ej: rojo/naranja)
+ 
+ ### üí∞ Regla 4: Valor del D√≥lar
+ 
+ Al generar una factura:
+ - Capturar el valor del d√≥lar al momento de la creaci√≥n
+ - Usar este valor para c√°lculos de precios en moneda extranjera
+ - El valor queda "congelado" para esa factura
+ 
+ ### üìã Regla 5: Generaci√≥n de Factura desde Pedido
+ 
+ Al generar factura desde un pedido:
+ 1. Verificar cambios sin guardar
+ 2. Copiar todos los items del pedido a la factura
+ 3. Heredar:
+    - Cliente
+    - Fecha de emisi√≥n (usar fecha actual)
+    - Art√≠culos y cantidades
+    - Descuento especial
+    - Observaciones
+ 4. Generar nuevo n√∫mero de factura autom√°ticamente
+ 
+ ### üìù Regla 6: Validaciones de Pedido
+ 
+ Antes de guardar un pedido, validar:
+ 1. ‚úÖ **Cliente obligatorio**: Debe tener un cliente seleccionado
+ 2. ‚úÖ **Items obligatorios**: Debe tener al menos 1 art√≠culo
+ 3. ‚úÖ **Cantidades v√°lidas**: Todas las cantidades &gt; 0
+ 4. ‚ö†Ô∏è **Stock disponible**: Verificar stock cr√≠tico (seg√∫n configuraci√≥n)
+ 
+ ---
+ 
+ ## Implementaci√≥n Recomendada
+ 
+ ### Estructura de Estado TypeScript
+ 
+ &#96;&#96;&#96;typescript
+ // types/salesOrder.ts
+ 
+ export interface SalesOrderStatus {
+   id: number | null;
+   hasInvoice: boolean;
+   invoicePrinted: boolean;
+   invoiceCancelled: boolean;
+   hasDeliveryNote: boolean;
+   hasUnsavedChanges: boolean;
+ }
+ 
+ export interface SalesOrderPermissions {
+   canEdit: boolean;
+   canSave: boolean;
+   canCreateInvoice: boolean;
+   canCancel: boolean;
+   canDelete: boolean;
+   canCreateDeliveryNote: boolean;
+ }
+ 
+ export const calculatePermissions = (
+   status: SalesOrderStatus
+ ): SalesOrderPermissions =&gt; {
+   return {
+     // No se puede editar si la factura fue impresa
+     canEdit: !status.invoicePrinted,
+     
+     // Solo se puede guardar si es editable
+     canSave: !status.invoicePrinted,
+     
+     // Solo crear factura si est√° guardado y no tiene factura activa
+     canCreateInvoice: 
+       status.id !== null &amp;&amp; 
+       (!status.hasInvoice || status.invoiceCancelled),
+     
+     // No cancelar si tiene factura impresa
+     canCancel: !status.invoicePrinted,
+     
+     // No eliminar si tiene factura (impresa o no)
+     canDelete: !status.hasInvoice,
+     
+     // Crear remito si est√° guardado
+     canCreateDeliveryNote: status.id !== null
+   };
+ };
+ &#96;&#96;&#96;
+ 
+ ### Hook React Personalizado
+ 
+ &#96;&#96;&#96;typescript
+ // hooks/useSalesOrderPermissions.ts
+ 
+ import { useMemo } from 'react';
+ import { SalesOrder } from '@/types';
+ import { calculatePermissions } from '@/lib/permissions';
+ 
+ export const useSalesOrderPermissions = (salesOrder: SalesOrder) =&gt; {
+   const permissions = useMemo(() =&gt; {
+     const status = {
+       id: salesOrder.id,
+       hasInvoice: !!salesOrder.invoice,
+       invoicePrinted: salesOrder.invoice?.printed ?? false,
+       invoiceCancelled: salesOrder.invoice?.cancelled ?? false,
+       hasDeliveryNote: !!salesOrder.deliveryNote,
+       hasUnsavedChanges: salesOrder.hasUnsavedChanges ?? false
+     };
+     
+     return calculatePermissions(status);
+   }, [salesOrder]);
+   
+   return permissions;
+ };
+ &#96;&#96;&#96;
+ 
+ ### Uso en Componentes
+ 
+ &#96;&#96;&#96;typescript
+ // app/dashboard/sales-orders/[id]/page.tsx
+ 
+ export default function SalesOrderDetailPage({ params }: Props) {
+   const { data: salesOrder } = useSalesOrder(params.id);
+   const permissions = useSalesOrderPermissions(salesOrder);
+   
+   return (
+     &lt;div&gt;
+       {/* Formulario en modo lectura si no puede editar */}
+       &lt;SalesOrderForm 
+         salesOrder={salesOrder}
+         readOnly={!permissions.canEdit}
+       /&gt;
+       
+       {/* Botones seg√∫n permisos */}
+       &lt;div className="flex gap-2"&gt;
+         &lt;Button 
+           onClick={handleSave}
+           disabled={!permissions.canSave}
+         &gt;
+           Guardar Cambios
+         &lt;/Button&gt;
+         
+         &lt;Button 
+           onClick={handleCreateInvoice}
+           disabled={!permissions.canCreateInvoice}
+         &gt;
+           Crear Factura
+         &lt;/Button&gt;
+         
+         &lt;Button 
+           onClick={handleCancel}
+           disabled={!permissions.canCancel}
+           variant="destructive"
+         &gt;
+           Cancelar Pedido
+         &lt;/Button&gt;
+         
+         &lt;Button onClick={handleGoBack} variant="outline"&gt;
+           Volver
+         &lt;/Button&gt;
+       &lt;/div&gt;
+     &lt;/div&gt;
+   );
+ }
+ &#96;&#96;&#96;
+ 
+ ### API Endpoint para Verificar Estado
+ 
+ &#96;&#96;&#96;typescript
+ // app/api/sales-orders/[id]/status/route.ts
+ 
+ export async function GET(
+   request: Request,
+   { params }: { params: { id: string } }
+ ) {
+   const salesOrderId = parseInt(params.id);
+   
+   const salesOrder = await db.salesOrder.findUnique({
+     where: { id: salesOrderId },
+     include: {
+       invoice: true,
+       deliveryNote: true
+     }
+   });
+   
+   if (!salesOrder) {
+     return NextResponse.json(
+       { error: 'Pedido no encontrado' },
+       { status: 404 }
+     );
+   }
+   
+   const status: SalesOrderStatus = {
+     id: salesOrder.id,
+     hasInvoice: !!salesOrder.invoice,
+     invoicePrinted: salesOrder.invoice?.printed ?? false,
+     invoiceCancelled: salesOrder.invoice?.cancelled ?? false,
+     hasDeliveryNote: !!salesOrder.deliveryNote,
+     hasUnsavedChanges: false // Esto se maneja en el cliente
+   };
+   
+   const permissions = calculatePermissions(status);
+   
+   return NextResponse.json({
+     status,
+     permissions
+   });
+ }
+ &#96;&#96;&#96;
+ 
+ ---
+ 
+ ## Matriz de Decisi√≥n R√°pida
+ 
+ ### Pedidos
+ 
+ | Estado del Pedido | Guardar | Crear Factura | Cancelar | Editar |
+ |-------------------|---------|---------------|----------|--------|
+ | Nuevo (sin guardar) | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
+ | Guardado sin factura | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
+ | Con factura sin imprimir | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
+ | Con factura impresa | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
+ | Con factura cancelada | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
+ 
+ ### Facturas
+ 
+ | Estado de la Factura | Guardar | Imprimir | Cancelar | Editar |
+ |----------------------|---------|----------|----------|--------|
+ | Nueva (sin guardar) | ‚úÖ | ‚ùå | ‚úÖ | ‚úÖ |
+ | Guardada sin imprimir | ‚úÖ | ‚úÖ | ‚úÖ | ‚úÖ |
+ | Impresa | ‚ùå | ‚úÖ (copia) | ‚úÖ | ‚ùå |
+ | Cancelada | ‚ùå | ‚ùå | ‚ùå | ‚ùå |
+ 
+ ---
+ 
+ ## Referencias al C√≥digo Legacy
+ 
+ ### Archivos Clave Analizados
+ 
+ 1. **SPISA.Presentacion/frmPrincipal.cs**
+    - L√≠neas 554-600: Generaci√≥n de facturas
+    - L√≠neas 221-275: Impresi√≥n de facturas
+    - L√≠neas 277-319: Cancelaci√≥n de facturas
+    - L√≠neas 658-707: Almacenamiento de pedidos
+ 
+ 2. **SPISA.Presentacion/UC/NotaPedido.cs**
+    - L√≠neas 288-384: M√©todo Guardar()
+    - L√≠neas 390-445: Validaciones de campos
+    - L√≠neas 498-508: SetearFormularioNoModificable()
+ 
+ 3. **SPISA_LogicaDeNegocios/NotaPedido.cs**
+    - L√≠neas 484-504: GenerarFactura()
+    - L√≠neas 506-516: GenerarRemito()
+    - L√≠neas 402-447: M√©todo Guardar()
+ 
+ 4. **SPISA_LogicaDeNegocios/Factura.cs**
+    - L√≠neas 95-104: Propiedades FueImpresa y FueCancelada
+    - L√≠neas 386-432: AlmacenarImpresion()
+    - L√≠neas 579-612: Cancelar()
+ 
+ 5. **SPISA.Presentacion/ExplorerBarGroups.xml**
+    - Define todos los grupos de botones seg√∫n estado
+ 
+ ---
+ 
+ ## Notas Adicionales
+ 
+ ### Diferencias entre Sistema Legacy y Nuevo
+ 
+ El sistema legacy usa un modelo MDI (Multiple Document Interface) con pesta√±as y un ExplorerBar lateral que cambia din√°micamente seg√∫n el contexto.
+ 
+ El sistema nuevo debe adaptar esta l√≥gica a una SPA moderna:
+ - Los "grupos" XML se convierten en estados de permisos
+ - Los botones de la barra lateral ahora son botones en la interfaz
+ - El estado se gestiona con React state/hooks en lugar de propiedades de formularios Windows
+ 
+ ### Pr√≥ximos Pasos Recomendados
+ 
+ 1. ‚úÖ Documentar l√≥gica de estados (este documento)
+ 2. ‚¨ú Crear tipos TypeScript para estados y permisos
+ 3. ‚¨ú Implementar hook &#96;useSalesOrderPermissions&#96;
+ 4. ‚¨ú Actualizar componentes de pedidos para usar permisos
+ 5. ‚¨ú Implementar validaciones del lado del servidor
+ 6. ‚¨ú Agregar tests unitarios para l√≥gica de permisos
+ 7. ‚¨ú Implementar indicadores visuales (solo lectura, advertencias, etc.)
+ 
+ ---
+ 
+ **Documento creado**: 2025-10-29
+ **Basado en**: An√°lisis del c√≥digo legacy SPISA Gesti√≥n 2007
+ **√öltima actualizaci√≥n**: 2025-10-29
+ 
```

</details>

</tool-use>

---

Perfecto, he creado el documento `BUTTON_STATUSES.md` con toda la investigaci√≥n detallada sobre la l√≥gica de estados y botones del sistema antiguo.

## Resumen del Documento

El documento incluye:

### üìã **Contenido Principal**
1. **Estados de Pedidos** - Los 5 estados posibles con sus botones espec√≠ficos
2. **Estados de Facturas** - Los 4 estados con propiedades FueImpresa/FueCancelada
3. **Estados de Remitos** - Los 3 estados y su relaci√≥n con facturas impresas
4. **L√≥gica de Botones** - Implementaci√≥n detallada para cada bot√≥n

### üîë **Reglas Cr√≠ticas Documentadas**
- **Inmutabilidad por Impresi√≥n**: Cuando se imprime una factura, todo queda bloqueado
- **Relaciones entre documentos**: 1 pedido ‚Üí m√°x 1 factura ‚Üí m√°x 1 remito
- **Stock Cr√≠tico**: Validaci√≥n configurable cuando cantidad > stock
- **Valor del D√≥lar**: Se captura al momento de generar la factura
- **Generaci√≥n de Factura**: Hereda todo del pedido autom√°ticamente

### üíª **Implementaci√≥n en TypeScript**
- Interfaces para estados y permisos
- Funci√≥n `calculatePermissions()` con toda la l√≥gica
- Hook personalizado `useSalesOrderPermissions`
- Ejemplos de uso en componentes React
- Endpoint API para verificar estado

### üìä **Matrices de Decisi√≥n**
- Tabla r√°pida de referencia para pedidos
- Tabla r√°pida de referencia para facturas
- Referencias exactas al c√≥digo legacy analizado

¬øQuieres que ahora implemente esta l√≥gica en el sistema nuevo, empezando por crear los tipos TypeScript y el hook de permisos?

---

