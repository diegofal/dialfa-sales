<!-- Generated by SpecStory, Markdown v2.1.0 -->

<!-- cursor Session 30ecc349-506b-42bf-b0ff-ddea360f8184 (2025-12-29 01:40Z) -->

# Actualizaci√≥n de pesos unitarios desde proformas (2025-12-29 01:40Z)

_**User (2025-12-26 23:39Z)**_

necesitamos una forma de actualizar los pesos unitarios en la base de datos de articulos apartir de las proformas.  esto es, un boton que actualice t odos al ultimo valor encontrado, que seria la proforma actual. avisame si se entiende

---

_**Agent (model claude-4.5-opus-high-thinking, mode Ask)**_

<think><details><summary>Thought Process</summary>
El usuario est√° preguntando sobre una funcionalidad para actualizar los pesos unitarios de los art√≠culos en la base de datos a partir de las proformas. Necesito entender:

1. La estructura de la base de datos de art√≠culos
2. C√≥mo se almacenan las proformas y sus pesos
3. La relaci√≥n entre art√≠culos y proformas

D√©jame buscar en el c√≥digo para entender mejor la estructura actual.</details></think>

---

S√≠, entiendo perfectamente. Quieres un bot√≥n que tome el peso unitario de la √∫ltima proforma (la actual que est√°s viendo) y actualice el campo de peso unitario en la tabla de art√≠culos para todos los art√≠culos que aparecen en esa proforma.

D√©jame revisar la estructura actual del c√≥digo para entender c√≥mo est√°n relacionadas las proformas con los art√≠culos y d√≥nde se almacenan los pesos.

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">

</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">

</tool-use>

---

<think><details><summary>Thought Process</summary>
Las b√∫squedas sem√°nticas no dieron resultados. D√©jame usar grep para buscar t√©rminos m√°s espec√≠ficos.</details></think>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "unitWeight|unit_weight|peso.*unitario|pesoUnitario" in "d:\dialfa new\spisa-new" ‚Ä¢ 23 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `.\frontend\app\dashboard\supplier-orders\[id]\page.tsx` | `<td class="text-right">$\{item.unitWeight ? item.unitWeight.toFixed(2) + ' kg' : '-'\}</td>` | L517 |
| `.\frontend\app\dashboard\supplier-orders\[id]\page.tsx` | `\{item.unitWeight ? `$\{item.unitWeight.toFixed(2)\} kg` : '-'\}` | L1122 |
| `.\frontend\components\supplierOrders\ImportPreviewDialog.tsx` | `unitWeight: item.unitWeight,` | L78 |
| `.\frontend\components\supplierOrders\ImportPreviewDialog.tsx` | `item.unitWeight \|\| 0,` | L142 |
| `.\frontend\components\supplierOrders\ImportPreviewDialog.tsx` | `\{item.unitWeight > 0 ? `$\{item.unitWeight.toFixed(2)\} kg` : '-'\}` | L300 |
| `.\frontend\components\supplierOrders\ImportPreviewDialog.tsx` | `\{item.unitWeight > 0 ? `$\{item.unitWeight.toFixed(2)\} kg` : '-'\}` | L381 |
| `.\frontend\types\supplierOrder.ts` | `unitWeight?: number \| null;` | L49 |
| `.\frontend\app\api\supplier-orders\[id]\route.ts` | `unitWeight?: number \| null;` | L15 |
| `.\frontend\app\api\supplier-orders\[id]\route.ts` | `unitWeight: item.unit_weight ? Number(item.unit_weight) : null,` | L84 |
| `.\frontend\app\api\supplier-orders\[id]\route.ts` | `unit_weight: item.unitWeight \|\| null,` | L162 |
| `.\frontend\app\api\supplier-orders\route.ts` | `unitWeight?: number \| null;` | L15 |
| `.\frontend\app\api\supplier-orders\route.ts` | `unitWeight: item.unit_weight ? Number(item.unit_weight) : null,` | L89 |
| `.\frontend\app\api\supplier-orders\route.ts` | `unit_weight: item.unitWeight \|\| null,` | L177 |
| `.\frontend\prisma\schema.prisma` | `unit_weight             Decimal?        @db.Decimal(10, 3)` | L523 |
| `.\frontend\lib\services\proformaImport\article-matcher.ts` | `unitWeight: number;` | L339 |
| `.\frontend\lib\services\proformaImport\article-matcher.ts` | `const unitWeight = item.unitWeight \|\| 0;` | L343 |
| `.\frontend\lib\services\proformaImport\article-matcher.ts` | `unitWeight,` | L354 |
| `.\frontend\lib\services\proformaImport\article-matcher.ts` | `unitWeight,` | L376 |
| `.\frontend\lib\services\proformaImport\types.ts` | `unitWeight?: number;` | L11 |
| `.\frontend\lib\services\proformaImport\types.ts` | `unitWeight: number;               // Peso unitario (kg)` | L61 |
| `.\frontend\lib\services\proformaImport\bestflow-extractor.ts` | `private readonly COL_UNIT_WEIGHT = 4; // Unit Weight` | L22 |
| `.\frontend\lib\services\proformaImport\bestflow-extractor.ts` | `const unitWeight = this.parseNumber(row[this.COL_UNIT_WEIGHT]);` | L120 |
| `.\frontend\lib\services\proformaImport\bestflow-extractor.ts` | `unitWeight,` | L135 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ahora entiendo mejor. Veo que:
1. Los items de las √≥rdenes de proveedor (proformas) tienen un campo `unitWeight` / `unit_weight`
2. Est√° almacenado en el esquema Prisma como `unit_weight` en la tabla de items

Ahora necesito ver:
1. Si los art√≠culos tienen un campo de peso unitario
2. C√≥mo est√° estructurada la tabla de art√≠culos

D√©jame buscar el esquema de art√≠culos y c√≥mo se podr√≠a actualizar el peso.</details></think>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "unit_weight|unitWeight" in "d:\dialfa new\spisa-new\frontend\prisma\schema.prisma" ‚Ä¢ 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/prisma/schema.prisma` | `unit_weight             Decimal?        @db.Decimal(10, 3)` | L523 |


</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "model.*Article|model.*articulos" in "d:\dialfa new\spisa-new\frontend\prisma\schema.prisma" ‚Ä¢ 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/prisma/schema.prisma` | `model articles \{` | L42 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ahora entiendo la estructura:

1. **Tabla `articles`** - tiene un campo `weight_kg` (Decimal 18,2) que almacena el peso del art√≠culo
2. **Tabla `supplier_order_items`** (items de proforma) - tiene `unit_weight` (Decimal 10,3) que viene de la proforma importada

Lo que el usuario quiere es:
- Un bot√≥n en la p√°gina de detalle de la proforma (`supplier-orders/[id]/page.tsx`)
- Que tome el `unit_weight` de cada item de la proforma
- Y actualice el campo `weight_kg` del art√≠culo correspondiente en la tabla `articles`

Necesito ver:
1. C√≥mo est√° la relaci√≥n entre `supplier_order_items` y `articles` (para saber c√≥mo matchear)
2. Si hay una API existente para actualizar art√≠culos</details></think>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "article_id|articleId" in "d:\dialfa new\spisa-new\frontend\prisma\schema.prisma" ‚Ä¢ 16 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/prisma/schema.prisma` | `article_id          BigInt` | L201 |
| `frontend/prisma/schema.prisma` | `articles            articles       @relation(fields: [article_id], references: [id], onUpdate: NoAction, map: "f_k_delivery_note_items__articles_article_id")` | L206 |
| `frontend/prisma/schema.prisma` | `@@index([article_id], map: "ix_delivery_note_items_article_id")` | L210 |
| `frontend/prisma/schema.prisma` | `article_id          BigInt` | L218 |
| `frontend/prisma/schema.prisma` | `articles            articles @relation(fields: [article_id], references: [id], onUpdate: NoAction, map: "f_k_invoice_items__articles_article_id")` | L227 |
| `frontend/prisma/schema.prisma` | `@@index([article_id], map: "ix_invoice_items_article_id")` | L231 |
| `frontend/prisma/schema.prisma` | `article_id       BigInt` | L263 |
| `frontend/prisma/schema.prisma` | `articles         articles     @relation(fields: [article_id], references: [id], onUpdate: NoAction, map: "f_k_sales_order_items_articles_article_id")` | L269 |
| `frontend/prisma/schema.prisma` | `@@index([article_id], map: "IX_sales_order_items_article_id")` | L272 |
| `frontend/prisma/schema.prisma` | `@@index([sales_order_id, article_id], map: "IX_sales_order_items_sales_order_id_article_id")` | L273 |
| `frontend/prisma/schema.prisma` | `article_id         BigInt` | L301 |
| `frontend/prisma/schema.prisma` | `articles           articles  @relation(fields: [article_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "f_k_stock_movements_articles_article_id")` | L312 |
| `frontend/prisma/schema.prisma` | `@@index([article_id], map: "IX_stock_movements_article_id")` | L314 |
| `frontend/prisma/schema.prisma` | `article_id              BigInt` | L513 |
| `frontend/prisma/schema.prisma` | `article                 articles        @relation(fields: [article_id], references: [id], onUpdate: NoAction, map: "f_k_supplier_order_items__articles_article_id")` | L532 |
| `frontend/prisma/schema.prisma` | `@@index([article_id], map: "IX_supplier_order_items_article_id")` | L535 |


</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Perfecto. Ahora veo que:
1. `supplier_order_items` tiene `article_id` que referencia a `articles`
2. `supplier_order_items` tiene `unit_weight`
3. `articles` tiene `weight_kg`

Necesito ver:
1. La API de art√≠culos para entender c√≥mo actualizarlos
2. C√≥mo est√° estructurada la p√°gina de detalle de proforma para agregar el bot√≥n</details></think>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\api\articles\[id]\route.ts</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\api\supplier-orders\[id]\route.ts</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ahora tengo toda la informaci√≥n que necesito. Entiendo:

1. **Estructura de datos:**
   - `supplier_order_items` tiene `article_id` y `unit_weight`
   - `articles` tiene `weight_kg`

2. **La funcionalidad necesaria:**
   - Crear un endpoint nuevo para actualizar pesos
   - Agregar un bot√≥n en la p√°gina de detalle de la proforma

Voy a proponer la soluci√≥n:

1. **Nuevo endpoint API** (`/api/supplier-orders/[id]/sync-weights`) que:
   - Reciba el ID de la proforma
   - Lea todos los items de esa proforma
   - Para cada item que tenga `unit_weight`, actualice el `weight_kg` del art√≠culo correspondiente

2. **Bot√≥n en la UI** en la p√°gina de detalle de la proforma que llame a este endpoint

D√©jame ver la estructura actual de la p√°gina para ver d√≥nde colocar el bot√≥n.</details></think>

---

Ahora tengo claro el contexto. D√©jame ver la p√°gina de detalle para entender d√≥nde colocar el bot√≥n:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Necesito ver la parte donde est√°n los botones de acci√≥n en la p√°gina para entender d√≥nde colocar el nuevo bot√≥n.</details></think>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "Button|handleExport|Download" in "d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx" ‚Ä¢ 13 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `import \{ ArrowLeft, Package, Download \} from 'lucide-react';` | L5 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `import \{ Button \} from '@/components/ui/button';` | L6 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `const handleExportToHTML = () => \{` | L236 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `<Button` | L595 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `</Button>` | L601 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `<Button` | L608 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `onClick=\{handleExportToHTML\}` | L610 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `<Download className="h-4 w-4" />` | L613 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `</Button>` | L615 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `<Button` | L819 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `</Button>` | L827 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `\{/* Reset Overrides Button */\}` | L834 |
| `frontend/app/dashboard/supplier-orders/[id]/page.tsx` | `<Button` | L840 |


</details>
</tool-use>

---

<think><details><summary>Thought Process</summary>
Ahora entiendo la estructura. Veo que hay un bot√≥n "Descargar HTML" en el header. Ser√≠a un buen lugar para agregar otro bot√≥n para sincronizar pesos.

Ahora voy a proponer la soluci√≥n completa:

1. Crear un nuevo endpoint API `/api/supplier-orders/[id]/sync-weights` 
2. Agregar un bot√≥n en la p√°gina de detalle

D√©jame tambi√©n verificar si hay alg√∫n listado de items que no tienen peso, para poder determinar cu√°ntos se actualizar√≠an.</details></think>

---

Ahora tengo toda la informaci√≥n. Aqu√≠ est√° el plan para implementar la funcionalidad:

## Resumen del Dise√±o

**Lo que necesitas:**
1. Un nuevo endpoint API para sincronizar los pesos unitarios de la proforma hacia los art√≠culos
2. Un bot√≥n en la p√°gina de detalle de la proforma para ejecutar esta acci√≥n

### 1. Nuevo Endpoint API: `/api/supplier-orders/[id]/sync-weights/route.ts`

```typescript
import { NextRequest, NextResponse } from 'next/server';
import { prisma } from '@/lib/db';
import { getUserFromRequest } from '@/lib/auth/roles';
import { logActivity } from '@/lib/services/activityLogger';
import { OPERATIONS } from '@/lib/constants/operations';

export async function POST(
  request: NextRequest,
  { params }: { params: Promise<{ id: string }> }
) {
  try {
    const user = await getUserFromRequest(request);
    if (!user || user.role !== 'admin') {
      return NextResponse.json({ error: 'No autorizado' }, { status: 401 });
    }

    const { id: idParam } = await params;
    const orderId = BigInt(idParam);

    // Obtener la orden con sus items
    const order = await prisma.supplier_orders.findUnique({
      where: { id: orderId },
      include: {
        supplier_order_items: true,
      },
    });

    if (!order) {
      return NextResponse.json(
        { error: 'Pedido no encontrado' },
        { status: 404 }
      );
    }

    // Filtrar items que tienen peso unitario definido
    const itemsWithWeight = order.supplier_order_items.filter(
      item => item.unit_weight !== null && Number(item.unit_weight) > 0
    );

    if (itemsWithWeight.length === 0) {
      return NextResponse.json({
        success: true,
        message: 'No hay pesos unitarios para sincronizar',
        updatedCount: 0,
      });
    }

    // Actualizar el peso en cada art√≠culo
    let updatedCount = 0;
    const updates: { articleId: bigint; articleCode: string; newWeight: number }[] = [];

    for (const item of itemsWithWeight) {
      const newWeight = Number(item.unit_weight);
      
      await prisma.articles.update({
        where: { id: item.article_id },
        data: {
          weight_kg: newWeight,
          updated_at: new Date(),
          updated_by: user.userId,
        },
      });

      updates.push({
        articleId: item.article_id,
        articleCode: item.article_code,
        newWeight,
      });
      updatedCount++;
    }

    // Log de actividad
    await logActivity({
      request,
      operation: OPERATIONS.ARTICLE_UPDATE,
      description: `Pesos unitarios sincronizados desde pedido ${order.order_number}: ${updatedCount} art√≠culos actualizados`,
      entityType: 'supplier_order',
      entityId: orderId,
      details: { 
        orderNumber: order.order_number,
        updatedArticles: updates.map(u => ({
          code: u.articleCode,
          weight: u.newWeight,
        })),
      },
    });

    return NextResponse.json({
      success: true,
      message: `Se actualizaron ${updatedCount} art√≠culos con sus pesos unitarios`,
      updatedCount,
      updates: updates.map(u => ({
        articleCode: u.articleCode,
        newWeight: u.newWeight,
      })),
    });
  } catch (error) {
    console.error('Error syncing weights:', error);
    return NextResponse.json(
      { error: 'Error al sincronizar pesos' },
      { status: 500 }
    );
  }
}
```

### 2. Modificaciones en la p√°gina de detalle (`page.tsx`)

Agregar estas modificaciones:

```typescript
// ... existing imports ...
import { Scale } from 'lucide-react'; // Agregar este import para el √≠cono

// Agregar estado para controlar la sincronizaci√≥n
const [syncingWeights, setSyncingWeights] = useState(false);

// Agregar la funci√≥n handler
const handleSyncWeights = async () => {
  if (!order || !confirm('¬øSincronizar los pesos unitarios de esta proforma a los art√≠culos? Esto actualizar√° el campo "Peso (kg)" de cada art√≠culo.')) {
    return;
  }

  setSyncingWeights(true);
  try {
    const response = await axios.post(`/api/supplier-orders/${order.id}/sync-weights`);
    
    if (response.data.success) {
      alert(`‚úÖ ${response.data.message}`);
    } else {
      alert('Error: ' + (response.data.error || 'Error desconocido'));
    }
  } catch (error: unknown) {
    const axiosError = error as { response?: { data?: { error?: string } } };
    console.error('Error syncing weights:', error);
    alert('Error al sincronizar pesos: ' + (axiosError.response?.data?.error || 'Error de conexi√≥n'));
  } finally {
    setSyncingWeights(false);
  }
};

// En el header, agregar el bot√≥n junto al de "Descargar HTML":
<Button
  variant="outline"
  onClick={handleSyncWeights}
  disabled={syncingWeights || !canEdit}
  className="gap-2"
  title="Actualizar el peso (kg) de cada art√≠culo con el peso unitario de esta proforma"
>
  <Scale className="h-4 w-4" />
  {syncingWeights ? 'Sincronizando...' : 'Sincronizar Pesos'}
</Button>
```

### Ubicaci√≥n del bot√≥n

El bot√≥n ir√≠a justo antes del bot√≥n "Descargar HTML" en el header de la p√°gina (alrededor de la l√≠nea 608):

```typescript
// ... existing code ...
<div className="flex-1">
  <h1 className="text-3xl font-bold">Pedido {order.orderNumber}</h1>
  <p className="text-muted-foreground">
    Creado el {new Date(order.orderDate).toLocaleDateString('es-AR')}
  </p>
</div>

{/* NUEVO BOT√ìN */}
<Button
  variant="outline"
  onClick={handleSyncWeights}
  disabled={syncingWeights || !canEdit}
  className="gap-2"
  title="Actualizar el peso (kg) de cada art√≠culo con el peso unitario de esta proforma"
>
  <Scale className="h-4 w-4" />
  {syncingWeights ? 'Sincronizando...' : 'Sincronizar Pesos'}
</Button>

<Button
  variant="outline"
  onClick={handleExportToHTML}
  className="gap-2"
>
  <Download className="h-4 w-4" />
  Descargar HTML
</Button>
// ... existing code ...
```

---

**¬øSe entiende la propuesta?** 

El flujo ser√≠a:
1. El admin ve la proforma con los items y sus pesos unitarios (que vienen del Excel importado)
2. Hace clic en "Sincronizar Pesos"
3. El sistema actualiza el campo `weight_kg` en la tabla `articles` para cada art√≠culo que tenga peso en esa proforma
4. Solo se actualizan los art√≠culos que tienen peso definido (> 0)

Si quieres que implemente esto, cambia a **Agent mode** y te lo aplico directamente.

---

_**User (2025-12-26 23:39Z)**_

procede

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
El usuario quiere que proceda con la implementaci√≥n. Ahora tengo acceso completo a las herramientas de escritura y modificaci√≥n de archivos.

Voy a:
1. Crear el nuevo endpoint API en `/api/supplier-orders/[id]/sync-weights/route.ts`
2. Modificar la p√°gina de detalle para agregar el bot√≥n y la funcionalidad

Primero necesito crear el directorio y el archivo de ruta, y luego modificar la p√°gina.</details></think>

---

Perfecto, voy a implementar la funcionalidad de sincronizaci√≥n de pesos. Comenzar√© creando el nuevo endpoint API y luego modificar√© la p√°gina de detalle.

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [-] Crear endpoint API sync-weights para actualizar pesos unitarios
- [ ] Modificar p√°gina de detalle para agregar bot√≥n sincronizar pesos
- [ ] Verificar que OPERATIONS tiene la constante necesaria

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="list_dir">
<details>
            <summary>Tool use: **list_dir** ‚Ä¢ Listed directory, 0 results</summary>
        
No results found
</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="write">

<details><summary>Tool use: **write** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\app\api\supplier-orders\[id]\sync-weights\route.ts</summary>

**Chunk 1**
Lines added: 105, lines removed: 1

```diff
@@ -1,1 +1,105 @@
- 
+ import { NextRequest, NextResponse } from 'next/server';
+ import { prisma } from '@/lib/db';
+ import { getUserFromRequest } from '@/lib/auth/roles';
+ import { logActivity } from '@/lib/services/activityLogger';
+ import { OPERATIONS } from '@/lib/constants/operations';
+ 
+ export async function POST(
+   request: NextRequest,
+   { params }: { params: Promise&lt;{ id: string }&gt; }
+ ) {
+   try {
+     const user = await getUserFromRequest(request);
+     if (!user || user.role !== 'admin') {
+       return NextResponse.json({ error: 'No autorizado' }, { status: 401 });
+     }
+ 
+     const { id: idParam } = await params;
+     const orderId = BigInt(idParam);
+ 
+     // Obtener la orden con sus items
+     const order = await prisma.supplier_orders.findUnique({
+       where: { id: orderId },
+       include: {
+         supplier_order_items: true,
+       },
+     });
+ 
+     if (!order) {
+       return NextResponse.json(
+         { error: 'Pedido no encontrado' },
+         { status: 404 }
+       );
+     }
+ 
+     // Filtrar items que tienen peso unitario definido
+     const itemsWithWeight = order.supplier_order_items.filter(
+       item =&gt; item.unit_weight !== null &amp;&amp; Number(item.unit_weight) &gt; 0
+     );
+ 
+     if (itemsWithWeight.length === 0) {
+       return NextResponse.json({
+         success: true,
+         message: 'No hay pesos unitarios para sincronizar',
+         updatedCount: 0,
+       });
+     }
+ 
+     // Actualizar el peso en cada art√≠culo
+     let updatedCount = 0;
+     const updates: { articleId: bigint; articleCode: string; newWeight: number }[] = [];
+ 
+     for (const item of itemsWithWeight) {
+       const newWeight = Number(item.unit_weight);
+       
+       await prisma.articles.update({
+         where: { id: item.article_id },
+         data: {
+           weight_kg: newWeight,
+           updated_at: new Date(),
+           updated_by: user.userId,
+         },
+       });
+ 
+       updates.push({
+         articleId: item.article_id,
+         articleCode: item.article_code,
+         newWeight,
+       });
+       updatedCount++;
+     }
+ 
+     // Log de actividad
+     await logActivity({
+       request,
+       operation: OPERATIONS.ARTICLE_UPDATE,
+       description: &#96;Pesos unitarios sincronizados desde pedido ${order.order_number}: ${updatedCount} art√≠culos actualizados&#96;,
+       entityType: 'supplier_order',
+       entityId: orderId,
+       details: { 
+         orderNumber: order.order_number,
+         updatedArticles: updates.map(u =&gt; ({
+           code: u.articleCode,
+           weight: u.newWeight,
+         })),
+       },
+     });
+ 
+     return NextResponse.json({
+       success: true,
+       message: &#96;Se actualizaron ${updatedCount} art√≠culos con sus pesos unitarios&#96;,
+       updatedCount,
+       updates: updates.map(u =&gt; ({
+         articleCode: u.articleCode,
+         newWeight: u.newWeight,
+       })),
+     });
+   } catch (error) {
+     console.error('Error syncing weights:', error);
+     return NextResponse.json(
+       { error: 'Error al sincronizar pesos' },
+       { status: 500 }
+     );
+   }
+ }
+ 
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Crear endpoint API sync-weights para actualizar pesos unitarios
- [ ] Modificar p√°gina de detalle para agregar bot√≥n sincronizar pesos
- [ ] Verificar que OPERATIONS tiene la constante necesaria

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Crear endpoint API sync-weights para actualizar pesos unitarios
- [-] Modificar p√°gina de detalle para agregar bot√≥n sincronizar pesos
- [ ] Verificar que OPERATIONS tiene la constante necesaria

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -3,5 +3,5 @@
  import { use, useEffect, useState, useMemo } from 'react';
  import { useRouter } from 'next/navigation';
- import { ArrowLeft, Package, Download } from 'lucide-react';
+ import { ArrowLeft, Package, Download, Scale } from 'lucide-react';
  import { Button } from '@/components/ui/button';
  import { Card } from '@/components/ui/card';
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -91,4 +91,5 @@
    const [discountOverrides, setDiscountOverrides] = useState&lt;Map&lt;number, number&gt;&gt;(new Map());
    const [globalDiscount, setGlobalDiscount] = useState&lt;string&gt;('');
+   const [syncingWeights, setSyncingWeights] = useState(false);
  
    const { data, isLoading } = useSupplierOrder(parseInt(id));
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

**Chunk 1**
Lines added: 23, lines removed: undefined

```diff
@@ -234,4 +234,27 @@
      }).format(price);
    };
+ 
+   const handleSyncWeights = async () =&gt; {
+     if (!order || !confirm('¬øSincronizar los pesos unitarios de esta proforma a los art√≠culos? Esto actualizar√° el campo "Peso (kg)" de cada art√≠culo.')) {
+       return;
+     }
+ 
+     setSyncingWeights(true);
+     try {
+       const response = await axios.post(&#96;/api/supplier-orders/${order.id}/sync-weights&#96;);
+       
+       if (response.data.success) {
+         alert(&#96;‚úÖ ${response.data.message}&#96;);
+       } else {
+         alert('Error: ' + (response.data.error || 'Error desconocido'));
+       }
+     } catch (error: unknown) {
+       const axiosError = error as { response?: { data?: { error?: string } } };
+       console.error('Error syncing weights:', error);
+       alert('Error al sincronizar pesos: ' + (axiosError.response?.data?.error || 'Error de conexi√≥n'));
+     } finally {
+       setSyncingWeights(false);
+     }
+   };
  
    const handleExportToHTML = () =&gt; {
```

</details>

</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx</summary>

**Chunk 1**
Lines added: 10, lines removed: undefined

```diff
@@ -630,4 +630,14 @@
            &lt;/p&gt;
          &lt;/div&gt;
+         &lt;Button
+           variant="outline"
+           onClick={handleSyncWeights}
+           disabled={syncingWeights || !canEdit}
+           className="gap-2"
+           title="Actualizar el peso (kg) de cada art√≠culo con el peso unitario de esta proforma"
+         &gt;
+           &lt;Scale className="h-4 w-4" /&gt;
+           {syncingWeights ? 'Sincronizando...' : 'Sincronizar Pesos'}
+         &lt;/Button&gt;
          &lt;Button
            variant="outline"
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Crear endpoint API sync-weights para actualizar pesos unitarios
- [x] Modificar p√°gina de detalle para agregar bot√≥n sincronizar pesos
- [-] Verificar que OPERATIONS tiene la constante necesaria

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "ARTICLE_UPDATE|export" in "d:\dialfa new\spisa-new\frontend\lib\constants\operations.ts" ‚Ä¢ 4 matches</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/lib/constants/operations.ts` | `export const OPERATIONS = \{` | L1 |
| `frontend/lib/constants/operations.ts` | `ARTICLE_UPDATE: 'ARTICLE_UPDATE',` | L30 |
| `frontend/lib/constants/operations.ts` | `export const OPERATION_LABELS: Record<string, string> = \{` | L54 |
| `frontend/lib/constants/operations.ts` | `ARTICLE_UPDATE: 'Modificar Art√≠culo',` | L72 |


</details>
</tool-use>

---

Perfecto, `OPERATIONS.ARTICLE_UPDATE` ya existe. Ahora voy a revisar si hay errores de lint en los archivos modificados:

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Crear endpoint API sync-weights para actualizar pesos unitarios
- [x] Modificar p√°gina de detalle para agregar bot√≥n sincronizar pesos
- [x] Verificar que OPERATIONS tiene la constante necesaria

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** ‚Ä¢ Read lints for 2 files</summary>
      
Lint paths:

- `d:\dialfa new\spisa-new\frontend\app\api\supplier-orders\[id]\sync-weights\route.ts`
- `d:\dialfa new\spisa-new\frontend\app\dashboard\supplier-orders\[id]\page.tsx`

Lint results


**No lint errors found**
</details>
</tool-use>

---

Excelente, no hay errores de lint. Ahora voy a crear un peque√±o resumen de los cambios implementados:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\api\supplier-orders\[id]\sync-weights\route.ts</summary>

</details>
</tool-use>

---

Perfecto! ‚úÖ He implementado exitosamente la funcionalidad de sincronizaci√≥n de pesos unitarios. Aqu√≠ est√° el resumen de lo que se hizo:

## üì¶ Cambios Implementados

### 1. **Nuevo Endpoint API** 
**Archivo:** `frontend/app/api/supplier-orders/[id]/sync-weights/route.ts`

Este endpoint:
- ‚úÖ Verifica que el usuario sea **admin**
- ‚úÖ Obtiene todos los items de la proforma con peso unitario definido (> 0)
- ‚úÖ Actualiza el campo `weight_kg` en la tabla `articles` para cada art√≠culo
- ‚úÖ Registra la actividad en el log del sistema
- ‚úÖ Retorna un resumen con la cantidad de art√≠culos actualizados y sus c√≥digos

### 2. **Modificaciones en la P√°gina de Detalle**
**Archivo:** `frontend/app/dashboard/supplier-orders/[id]/page.tsx`

Cambios realizados:
- ‚úÖ Importado el √≠cono `Scale` de lucide-react
- ‚úÖ Agregado estado `syncingWeights` para controlar el proceso
- ‚úÖ Implementada funci√≥n `handleSyncWeights()` que:
  - Solicita confirmaci√≥n al usuario
  - Llama al endpoint API
  - Muestra mensajes de √©xito/error
  - Maneja errores de conexi√≥n
- ‚úÖ Agregado bot√≥n **"Sincronizar Pesos"** en el header junto al bot√≥n "Descargar HTML"
  - Solo disponible para admins
  - Se deshabilita mientras sincroniza
  - Muestra tooltip explicativo

## üéØ Funcionamiento

1. El admin abre una proforma que tiene pesos unitarios cargados (importados desde Excel)
2. Hace clic en el bot√≥n **"Sincronizar Pesos"** 
3. Confirma la acci√≥n en el di√°logo
4. El sistema actualiza el campo `weight_kg` de cada art√≠culo en la base de datos
5. Se muestra un mensaje con la cantidad de art√≠culos actualizados
6. La acci√≥n queda registrada en el log de actividad

## üîí Seguridad

- Solo usuarios con rol **admin** pueden ejecutar esta acci√≥n
- Se valida la existencia de la proforma
- Se filtra solo art√≠culos con peso > 0
- Se registra en el log de actividad con detalles completos

La implementaci√≥n est√° completa y sin errores de lint. ¬øQuieres probarlo o necesitas alg√∫n ajuste?

---

_**User (2025-12-26 23:39Z)**_

ahora en el modulo de articulos necesito visualizar estos pesos si estan disponibles, como una columna mas. 

---

_**Agent (model claude-4.5-sonnet-thinking, mode Agent)**_

<think><details><summary>Thought Process</summary>
El usuario quiere agregar una columna en el m√≥dulo de art√≠culos para mostrar los pesos unitarios (weight_kg). Necesito:

1. Buscar d√≥nde se define la tabla de art√≠culos en el frontend
2. Agregar la columna "Peso (kg)" que muestre el campo weight_kg
3. Asegurarme de que los datos incluyan este campo en la consulta

Voy a buscar el componente de la tabla de art√≠culos.</details></think>

---

Perfecto, voy a agregar una columna de "Peso (kg)" en la tabla de art√≠culos para mostrar el `weight_kg` cuando est√© disponible.

---

<tool-use data-tool-type="search" data-tool-name="codebase_search">

</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="glob_file_search">
<details>
<summary>Tool use: **glob_file_search** ‚Ä¢ Searched codebase "**/articles/page.tsx" ‚Ä¢ **1** result in **1** directory</summary>

Directory: **d:\dialfa new\spisa-new\frontend** (1 file)

| File |
|------|
| `app\dashboard\articles\page.tsx` |

</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\dashboard\articles\page.tsx</summary>

</details>
</tool-use>

---

Ahora necesito ver el componente `ArticlesTable` donde se renderizan las columnas:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\components\articles\ArticlesTable.tsx</summary>

</details>
</tool-use>

---

Ahora necesito verificar el tipo `Article` para asegurarme de que incluya el campo `weightKg`:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\types\article.ts</summary>

</details>
</tool-use>

---

Perfecto, veo que el tipo `Article` no tiene el campo `weightKg`. Necesito agregarlo y luego actualizar el componente de la tabla. Voy a hacer los cambios necesarios:

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [-] Agregar weightKg al tipo Article
- [ ] Agregar columna Peso en ArticlesTable
- [ ] Verificar que el mapper incluye weightKg

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\types\article.ts</summary>

**Chunk 1**
Lines added: 1, lines removed: undefined

```diff
@@ -21,4 +21,5 @@
    salesTrendLabels?: string[];
    lastSaleDate?: string | null; // ISO date string
+   weightKg?: number | null;
  }
  
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Agregar weightKg al tipo Article
- [ ] Agregar columna Peso en ArticlesTable
- [-] Verificar que el mapper incluye weightKg

</details>
</tool-use>

---

<tool-use data-tool-type="search" data-tool-name="grep">
<details>
<summary>Tool use: **grep** ‚Ä¢ Grep for "mapArticleToDTO|function mapArticle" in "d:\dialfa new\spisa-new\frontend\lib\utils" ‚Ä¢ 1 match</summary>

Output mode: content


| File | Content | Line |
|------|------|------|
| `frontend/lib/utils\mapper.ts` | `export function mapArticleToDTO(article: unknown) \{` | L4 |


</details>
</tool-use>

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\lib\utils\mapper.ts</summary>

</details>
</tool-use>

---

Perfecto, el mapper ya incluye `weightKg` en la l√≠nea 34. Ahora voy a actualizar la tabla de art√≠culos para agregar la columna:

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Agregar weightKg al tipo Article
- [-] Agregar columna Peso en ArticlesTable
- [x] Verificar que el mapper incluye weightKg

</details>
</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\components\articles\ArticlesTable.tsx</summary>

**Chunk 1**
Lines added: 3, lines removed: undefined

```diff
@@ -138,4 +138,7 @@
                Stock M√≠n.
              &lt;/SortableTableHead&gt;
+             &lt;SortableTableHead align="right"&gt;
+               Peso (kg)
+             &lt;/SortableTableHead&gt;
              &lt;SortableTableHead&gt;Tendencia&lt;/SortableTableHead&gt;
              &lt;SortableTableHead&gt;ABC&lt;/SortableTableHead&gt;
```

</details>

</tool-use>

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\components\articles\ArticlesTable.tsx</summary>

**Chunk 1**
Lines added: 1, lines removed: 1

```diff
@@ -151,5 +151,5 @@
            {articles.length === 0 ? (
              &lt;TableRow&gt;
-               &lt;TableCell colSpan={10} className="text-center text-muted-foreground"&gt;
+               &lt;TableCell colSpan={11} className="text-center text-muted-foreground"&gt;
                  No hay art√≠culos para mostrar
                &lt;/TableCell&gt;
```

</details>

</tool-use>

---

Ahora necesito agregar la celda con el valor del peso en el cuerpo de la tabla:

---

<tool-use data-tool-type="write" data-tool-name="search_replace">

<details><summary>Tool use: **search_replace** ‚Ä¢ Edit file: d:\dialfa new\spisa-new\frontend\components\articles\ArticlesTable.tsx</summary>

**Chunk 1**
Lines added: 9, lines removed: undefined

```diff
@@ -200,4 +200,13 @@
                    {article.minimumStock}
                  &lt;/TableCell&gt;
+                 &lt;TableCell className="text-right"&gt;
+                   {article.weightKg ? (
+                     &lt;span className="text-sm font-medium"&gt;
+                       {article.weightKg.toFixed(2)}
+                     &lt;/span&gt;
+                   ) : (
+                     &lt;span className="text-xs text-muted-foreground"&gt;-&lt;/span&gt;
+                   )}
+                 &lt;/TableCell&gt;
                  &lt;TableCell&gt;
                    {article.salesTrend &amp;&amp; article.salesTrend.length &gt; 0 ? (
```

</details>

</tool-use>

---

<tool-use data-tool-type="task" data-tool-name="todo_write">
<details><summary>Tool use: **todo_write** ‚Ä¢ Todo List</summary>

- [x] Agregar weightKg al tipo Article
- [x] Agregar columna Peso en ArticlesTable
- [x] Verificar que el mapper incluye weightKg

</details>
</tool-use>

---

<tool-use data-tool-type="generic" data-tool-name="read_lints">
<details>
          <summary>Tool use: **read_lints** ‚Ä¢ Read lints for 2 files</summary>
      
Lint paths:

- `d:\dialfa new\spisa-new\frontend\components\articles\ArticlesTable.tsx`
- `d:\dialfa new\spisa-new\frontend\types\article.ts`

Lint results


**No lint errors found**
</details>
</tool-use>

---

Perfecto! Ahora voy a verificar que el endpoint de art√≠culos devuelva el campo `weight_kg` correctamente. D√©jame revisar la ruta de la API:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\api\articles\route.ts</summary>

</details>
</tool-use>

---

D√©jame verificar que el query de Prisma incluya el campo `weight_kg`:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\app\api\articles\route.ts</summary>

</details>
</tool-use>

---

El query de Prisma incluye todas las columnas por defecto, incluyendo `weight_kg`, as√≠ que deber√≠a funcionar correctamente. El mapper ya lo incluye. Ahora voy a hacer una verificaci√≥n final de que todo est√© listo:

---

<tool-use data-tool-type="read" data-tool-name="read_file">
<details><summary>Tool use: **read_file** ‚Ä¢ Read file: d:\dialfa new\spisa-new\frontend\components\articles\ArticlesTable.tsx</summary>

</details>
</tool-use>

---

Perfecto! Todo est√° implementado correctamente. D√©jame crear un resumen de los cambios realizados:

## ‚úÖ Implementaci√≥n Completada

He agregado exitosamente la columna de **Peso (kg)** en el m√≥dulo de art√≠culos. Aqu√≠ est√° el resumen de los cambios:

### üìù Archivos Modificados

#### 1. **Tipo Article** (`frontend/types/article.ts`)
- ‚úÖ Agregado el campo `weightKg?: number | null` a la interfaz `Article`

#### 2. **Tabla de Art√≠culos** (`frontend/components/articles/ArticlesTable.tsx`)
- ‚úÖ Agregado nuevo encabezado de columna "Peso (kg)" con alineaci√≥n a la derecha
- ‚úÖ Agregada celda que muestra el peso con formato de 2 decimales
- ‚úÖ Muestra "-" cuando no hay peso disponible
- ‚úÖ Actualizado el `colSpan` de la fila vac√≠a de 10 a 11 para incluir la nueva columna

### üé® Caracter√≠sticas de la Columna

La columna de peso se ubica **despu√©s de "Stock M√≠n."** y **antes de "Tendencia"**, mostrando:
- **Peso formateado**: `XX.XX` kg (2 decimales) cuando est√° disponible
- **Gui√≥n (--)**: Cuando el art√≠culo no tiene peso definido
- **Alineaci√≥n**: A la derecha para consistencia con las columnas num√©ricas
- **Estilo**: Texto peque√±o y en negrita para facilitar lectura

### üîÑ Flujo Completo

1. **Importar proforma** con pesos unitarios desde Excel
2. **Sincronizar pesos** usando el bot√≥n en la p√°gina de detalle de la proforma
3. **Visualizar pesos** en la tabla de art√≠culos (este cambio)

### üìä Integraci√≥n Existente

El mapper (`mapArticleToDTO`) ya inclu√≠a el campo `weightKg` desde antes, y el query de la API devuelve todos los campos de la tabla `articles` incluyendo `weight_kg`, por lo que la integraci√≥n es completa y no requiere cambios adicionales en el backend.

¬øQuieres probar la funcionalidad o necesitas alg√∫n ajuste adicional en la visualizaci√≥n?

---

